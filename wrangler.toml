# wrangler.toml

name = "meetsmatch-worker" # Default worker name
main = "worker/worker.js"  # Main entry point for the Wasm worker
compatibility_date = "2024-03-18" # Update as needed
# compatibility_flags = [] # Removed nodejs_compat, add others if necessary for Rust/Wasm

account_id = "4d12ccdb69bc57519b6aac269a04c9af" # Replace with your actual account ID

# Default (Production) Variables
# These apply if no specific environment is targeted or if [env.production] is not defined.
[vars]
ENVIRONMENT = "production"
LOG_LEVEL = "INFO"
# Add other production-specific variables here

# Default (Production) D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "prod-tele-meetsmatch-db"
database_id = "0aa74e08-f123-460e-ba5e-3c34db8a9538" # PRODUCTION DB ID

# Default (Production) KV Namespaces
[[kv_namespaces]]
binding = "KV" # Generic KV binding example
id = "prod-meetsmatch-KV" # PRODUCTION Generic KV ID

[[kv_namespaces]]
binding = "FEATURE_FLAGS_KV"
id = "prod-feature-flags-kv-id" # PRODUCTION Feature Flags KV Namespace ID

[[kv_namespaces]]
binding = "SESSIONS_KV"
id = "prod-session-kv-namespace-id" # PRODUCTION Session KV ID

# Default (Production) R2 Buckets
[[r2_buckets]]
binding = "R2"
bucket_name = "prod-tele-meetsmatch" # PRODUCTION R2 Bucket


# -------------------- Development Environment (`dev`) --------------------
[env.dev]
name = "meetsmatch-worker-dev" # Worker name for the dev environment

# Variables for the 'dev' environment
[env.dev.vars]
ENVIRONMENT = "development" # Note: 'development' not 'dev' to be more explicit
LOG_LEVEL = "DEBUG"
# Add other dev-specific variables

# Dev D1 Database binding
[[env.dev.d1_databases]]
binding = "DB"
database_name = "dev-tele-meetsmatch-db" # Name for a separate dev database
database_id = "your-dev-d1-database-id-here" # IMPORTANT: Replace with actual DEV D1 DB ID
# preview_database_id = "your-local-preview-d1-id" # For local 'wrangler dev' with a separate local D1

# Dev KV Namespaces
[[env.dev.kv_namespaces]]
binding = "FEATURE_FLAGS_KV"
id = "dev-feature-flags-kv-id" # IMPORTANT: Replace with actual DEV Feature Flags KV ID
preview_id = "dev-feature-flags-kv-preview-id" # For 'wrangler dev' local preview KV

[[env.dev.kv_namespaces]]
binding = "SESSIONS_KV"
id = "dev-sessions-kv-id" # IMPORTANT: Replace with actual DEV Sessions KV ID
preview_id = "dev-sessions-kv-preview-id" # For 'wrangler dev' local preview KV

# Example: If you had a generic KV namespace that also needs a dev version
# [[env.dev.kv_namespaces]]
# binding = "KV"
# id = "dev-generic-kv-id" # IMPORTANT: Replace with actual DEV Generic KV ID
# preview_id = "dev-generic-kv-preview-id"


# -------------------- Staging Environment (`staging`) --------------------
# This section provides an example for a staging environment.
# It's structured similarly to 'dev' or 'production'.
[env.staging]
name = "meetsmatch-worker-staging" # Worker name for the staging environment

[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "INFO" # Staging might use INFO like prod, or DEBUG if more verbosity is needed

[[env.staging.d1_databases]]
binding = "DB"
database_name = "staging-tele-meetsmatch-db"
database_id = "your-staging-d1-database-id-here" # IMPORTANT: Replace with actual STAGING D1 DB ID

[[env.staging.kv_namespaces]]
binding = "FEATURE_FLAGS_KV"
id = "staging-feature-flags-kv-id" # IMPORTANT: Replace with actual STAGING Feature Flags KV ID
# preview_id is less common for staging as it's usually a deployed environment, not local.

[[env.staging.kv_namespaces]]
binding = "SESSIONS_KV"
id = "staging-sessions-kv-id" # IMPORTANT: Replace with actual STAGING Sessions KV ID


# -------------------- Production Environment (`production`) Explicit Definition --------------------
# Optionally, you can explicitly define [env.production]
# If defined, 'wrangler deploy --env production' will use these settings.
# If not defined, 'wrangler deploy' (or 'wrangler deploy --env production' if no top-level default differs)
# would use the top-level settings.
# For clarity, explicitly defining it can be beneficial.
[env.production]
name = "meetsmatch-worker" # Can be the same as the top-level name or more specific like "meetsmatch-worker-prod"

# Variables for 'production' (can override top-level if needed, or be identical)
[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "INFO"

# Bindings for 'production' would typically mirror the top-level default bindings.
# You only need to list them here if they differ from the top-level defaults OR if you want explicit clarity.
# For example, if top-level 'DB' was for some reason not production, you'd define it here.
# [[env.production.d1_databases]]
# binding = "DB"
# database_name = "prod-tele-meetsmatch-db" # Ensure this matches your actual production D1
# database_id = "0aa74e08-f123-460e-ba5e-3c34db8a9538"

# [[env.production.kv_namespaces]]
# binding = "FEATURE_FLAGS_KV"
# id = "prod-feature-flags-kv-id" # Ensure this matches your actual production KV


# Secrets are managed outside wrangler.toml using `wrangler secret put`
# e.g., `wrangler secret put MY_SECRET --env production`
# `wrangler secret put MY_SECRET --env staging`
# `wrangler secret put MY_SECRET --env dev`

# Build configuration (usually global)
# [build]
# command = "./scripts/build.sh"
# watch_dir = "src"
# cwd = "." # Current working directory for the build command
# build_root = "." # Directory to run the build in (usually project root)
# upload.format = "service-worker" # For Rust/Wasm workers generated by wasm-pack (worker/worker.js)
# wasm_pack_kwargs = { out_dir = "worker", out_name = "worker", target = "bundler" } # wasm-pack specific options (if wrangler invokes it)

# Note on `wrangler deploy` vs `wrangler deploy --env <name>`:
# - `wrangler deploy` uses top-level settings unless an `[env.production]` section exists and is different,
#   or if no specific production-like environment is inferred.
# - `wrangler deploy --env production` explicitly targets the `[env.production]` section if it exists.
#   If `[env.production]` is NOT defined, it may fall back to top-level settings.
# It's good practice to define `[env.production]` if you define other `env` sections for clarity.
